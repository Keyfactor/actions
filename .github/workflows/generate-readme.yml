name: Generate README from templates and data files
on:
  workflow_call:
    secrets:
      token: 
        description: 'Secret token from caller workflow to approve readme'
        required: true

jobs:
  update-docs:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        action: [generate-screenshots, generate-repository-docs, lint-manifest]
    steps:
      - name: Download repo
        uses: keyfactor/checkout@v4
        with:
          token: ${{ secrets.V2BUILDTOKEN }}

      - uses: Keyfactor/doctool@main
        with:
          token: ${{ secrets.V2BUILDTOKEN }}
          action: ${{ matrix.action }}

      # - name: Download doctool
      #   uses: keyfactor/checkout@v4
      #   with:
      #     repository: 'Keyfactor/doctool'
      #     path: './doctool/'
      #     token: ${{ secrets.token }}
      #     ref: 'main' # Update this tag for testing new readme templates branches

      # - name: Run doctool action
      #   uses: ../doctool
      #   with:
      #     token: ${{ secrets.token }}
      #     action: ${{ matrix.action }}